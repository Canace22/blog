<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="canace 的博客"><title>Webpack | Canace 的博客</title><link rel="stylesheet" type="text/css" href="../css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="../favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="../favicon.ico"><link rel="apple-touch-icon" href="../apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="../apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="../atom.xml"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Webpack</h1><a id="logo" href="../.">Canace 的博客</a><p class="description">Tomorrow is another day</p></div><div id="nav-menu"><a class="current" href="../."><i class="fa fa-home"> 主页</i></a><a href="../archives/"><i class="fa fa-archive"> 文章归档</i></a><a href="../about/"><i class="fa fa-user"> 关于我</i></a><a href="../atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Webpack</h1><div class="post-meta">2019-08-04<span> | </span><span class="category"><a href="../categories/cli/">工程化与运维</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 2.1k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 10</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="post-content"><h2 id="一、安装"><a href="#一、安装" class="headerlink" title="一、安装"></a>一、安装</h2><h3 id="1-本地安装"><a href="#1-本地安装" class="headerlink" title="1. 本地安装"></a>1. 本地安装</h3><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="comment"># webpack 4+ 版本</span></span><br><span class="line">npm install <span class="params">--save-dev</span> webpack-cli</span><br><span class="line">npm install <span class="params">--save-dev</span> webpack</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装指定版本</span></span><br><span class="line">npm install <span class="params">--save-dev</span> webpack@&lt;<span class="keyword">version</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-全局安装（官方不推荐）"><a href="#2-全局安装（官方不推荐）" class="headerlink" title="2. 全局安装（官方不推荐）"></a>2. 全局安装（官方不推荐）</h3><figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">npm install <span class="comment">--global webpack</span></span><br></pre></td></tr></table></figure>

<h3 id="3-最新体验版安装"><a href="#3-最新体验版安装" class="headerlink" title="3. 最新体验版安装"></a>3. 最新体验版安装</h3><figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">npm</span> install webpack@beta</span><br><span class="line"><span class="built_in">npm</span> install webpack/webpack<span class="comment">#&lt;tagname/branchname&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-运行"><a href="#3-运行" class="headerlink" title="3. 运行"></a>3. 运行</h3><figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">webpack</span></span><br></pre></td></tr></table></figure>

<h2 id="二、入门"><a href="#二、入门" class="headerlink" title="二、入门"></a>二、入门</h2><h3 id="1-项目初始化"><a href="#1-项目初始化" class="headerlink" title="1. 项目初始化"></a>1. 项目初始化</h3><figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> webpack-<span class="built_in">demo</span> &amp;&amp; cd webpack-<span class="built_in">demo</span></span><br><span class="line"></span><br><span class="line">npm init -y</span><br><span class="line"></span><br><span class="line">npm install webpack webpack-cli --<span class="built_in">save</span>-dev</span><br></pre></td></tr></table></figure>

<h3 id="2-初始化源码目录"><a href="#2-初始化源码目录" class="headerlink" title="2. 初始化源码目录"></a>2. 初始化源码目录</h3><figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">mkdir src</span><br><span class="line">cd src<span class="built_in"></span></span><br><span class="line"><span class="built_in">new-item </span>index.js</span><br><span class="line">cd ..</span><br><span class="line">mkdir dist</span><br><span class="line">cd dist<span class="built_in"></span></span><br><span class="line"><span class="built_in">new-item </span>index.html</span><br></pre></td></tr></table></figure>

<h3 id="3-创建配置文件-webpack-config-js"><a href="#3-创建配置文件-webpack-config-js" class="headerlink" title="3. 创建配置文件 webpack.config.js"></a>3. 创建配置文件 webpack.config.js</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> <span class="variable">path</span> <span class="operator">=</span> require(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = &#123;</span><br><span class="line">  entry: <span class="string">&#x27;./src/index.js&#x27;</span>, <span class="comment">// 入口文件地址</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;bundle.js&#x27;</span>, <span class="comment">// 出口文件名</span></span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>) <span class="comment">// 告诉 webpack 在哪里生成文件</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="4-添加npm脚本"><a href="#4-添加npm脚本" class="headerlink" title="4. 添加npm脚本"></a>4. 添加npm脚本</h3><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"> &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;webpack-demo&quot;</span>,</span><br><span class="line">    <span class="string">&quot;private&quot;</span>: true,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;</span><span class="keyword">Error</span>: <span class="keyword">no</span> <span class="keyword">test</span> specified\<span class="string">&quot; &amp;&amp; exit 1&quot;</span>,</span><br><span class="line">+     <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;keywords&quot;</span>: [],</span><br><span class="line">    <span class="string">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">    <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;webpack&quot;</span>: <span class="string">&quot;^4.0.1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;webpack-cli&quot;</span>: <span class="string">&quot;^2.0.9&quot;</span>,</span><br><span class="line">      <span class="string">&quot;lodash&quot;</span>: <span class="string">&quot;^4.17.5&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-开始使用-webpack-打包：npm-run-build"><a href="#5-开始使用-webpack-打包：npm-run-build" class="headerlink" title="5. 开始使用 webpack 打包：npm run build"></a>5. 开始使用 webpack 打包：<code>npm run build</code></h3><blockquote>
<p>具体事例请参考 example 目录下的 chapterOne</p>
</blockquote>
<h2 id="三、静态资源管理"><a href="#三、静态资源管理" class="headerlink" title="三、静态资源管理"></a>三、静态资源管理</h2><h3 id="0-创建静态资源目录-asset"><a href="#0-创建静态资源目录-asset" class="headerlink" title="0. 创建静态资源目录 asset"></a>0. 创建静态资源目录 asset</h3><h3 id="1-css"><a href="#1-css" class="headerlink" title="1. css"></a>1. css</h3><p>(1) 安装对应的 loader： <code>npm install --save-dev style-loader css-loader</code></p>
<p>(2) 配置 loader：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [&#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">      <span class="attr">use</span>: [</span><br><span class="line">        <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>(3) 静态资源目录添加 style.css 文件，在入口文件中引用，在打包时， webpack 会把对应的 css 代码插入到 index.html 的 head 中。</p>
<h3 id="2-图片"><a href="#2-图片" class="headerlink" title="2. 图片"></a>2. 图片</h3><p>(1) 安装对应的 loader： <code>npm install --save-dev file-loader</code></p>
<p>(2) 配置 loader：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.(png|svg|jpg|gif)$/</span>,</span><br><span class="line">  <span class="attr">use</span>: [</span><br><span class="line">    <span class="string">&#x27;file-loader&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(3) 静态资源目录添加一张图片，在入口文件中引用，打包时， webpack 会生成目标文件夹中的最终 url，并将入口文件中的路径替换为最终路径。</p>
<h3 id="3-字体"><a href="#3-字体" class="headerlink" title="3. 字体"></a>3. 字体</h3><p>(1) 配置 loader：</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: /\.(woff|<span class="type">woff2</span>|<span class="type">eot</span>|<span class="type">ttf</span>|<span class="type">otf</span>)$/,</span><br><span class="line">  use: [</span><br><span class="line">    &#x27;file-loader&#x27;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(2) 静态资源目录添加字体，在入口文件中引用，打包时， webpack 会生成目标文件夹中的最终 url，并将入口文件中的路径替换为最终路径。</p>
<h3 id="4-数据（json、xml、csv）"><a href="#4-数据（json、xml、csv）" class="headerlink" title="4. 数据（json&lt;默认支持&gt;、xml、csv）"></a>4. 数据（json&lt;默认支持&gt;、xml、csv）</h3><p>(1) 安装对应的 loader: <code>npm install --save-dev csv-loader xml-loader</code></p>
<p>(2) 配置 loader：</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.(csv|tsv)$/</span>,</span><br><span class="line">  <span class="keyword">use</span>: [</span><br><span class="line">    <span class="string">&#x27;csv-loader&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.xml$/</span>,</span><br><span class="line">  <span class="keyword">use</span>: [</span><br><span class="line">    <span class="string">&#x27;xml-loader&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(3) 静态资源目录添加对应的数据文件，在入口文件中引用数据文件, 打包之后，对应的数据文件会被处理为 json 格式的数据</p>
<blockquote>
<p>具体事例请参考 example 目录下的 chapterTwo</p>
</blockquote>
<h2 id="四、输出管理"><a href="#四、输出管理" class="headerlink" title="四、输出管理"></a>四、输出管理</h2><h3 id="0-入口分离"><a href="#0-入口分离" class="headerlink" title="0. 入口分离"></a>0. 入口分离</h3><p>(1) 源码目录中新建 print.js 文件，并在 index.js 中引用对应模块，index.js 中引用对应的包</p>
<p>(2) webpack 配置修改：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">app</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">print</span>: <span class="string">&#x27;./src/print.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="1-解决引用重复的问题，每次打包生成新的-html-文件"><a href="#1-解决引用重复的问题，每次打包生成新的-html-文件" class="headerlink" title="1. 解决引用重复的问题，每次打包生成新的 html 文件"></a>1. 解决引用重复的问题，每次打包生成新的 html 文件</h3><p>(1) 设定 HtmlWebpackPlugin</p>
<p>安装 html-webpack-plugin: <code>npm install --save-dev html-webpack-plugin</code></p>
<p>(2) 配置 HtmlWebpackPlugin</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;Output Management&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>(3) 在打包时， HtmlWebpackPlugin 会生成新的 index.html 文件，替换旧的 index.html 文件</p>
<h3 id="2-删除遗留的多余文件-在每次构建前清理-dist-文件夹"><a href="#2-删除遗留的多余文件-在每次构建前清理-dist-文件夹" class="headerlink" title="2. 删除遗留的多余文件,在每次构建前清理 &#x2F;dist 文件夹"></a>2. 删除遗留的多余文件,在每次构建前清理 &#x2F;dist 文件夹</h3><p>(1) 安装插件: <code>npm install clean-webpack-plugin --save-dev</code></p>
<p>(2) 配置插件:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="title class_">CleanWebpackPlugin</span></span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br></pre></td></tr></table></figure>

<blockquote>
<p>具体事例请参考 example 目录下的 chapterThree</p>
</blockquote>
<h2 id="五、开发环境配置"><a href="#五、开发环境配置" class="headerlink" title="五、开发环境配置"></a>五、开发环境配置</h2><h3 id="1-将编译后的代码映射回原始源代码"><a href="#1-将编译后的代码映射回原始源代码" class="headerlink" title="1. 将编译后的代码映射回原始源代码"></a>1. 将编译后的代码映射回原始源代码</h3><p>(1) 配置文件中添加 source map 配置： <code>devtool: &#39;inline-source-map&#39;</code></p>
<p>(2) 入口文件有错误，控制台返回的错误路径是对应的源路径</p>
<h3 id="2-自动编译代码"><a href="#2-自动编译代码" class="headerlink" title="2. 自动编译代码"></a>2. 自动编译代码</h3><p>(1) 观察模式：</p>
<ul>
<li><p>添加 script 脚本：<code>&quot;watch&quot;: &quot;webpack --watch&quot;</code> </p>
</li>
<li><p><code>npm run watch</code>，每次更新入口文件，代码将自动编译，但是每次编译后，需要手动刷新浏览器，页面才会更新</p>
</li>
</ul>
<p>(2) webpack-dev-server（一个简单的web服务器，可以实时重新加载页面）（官方推荐使用）</p>
<ul>
<li><p>安装： <code>npm install --save-dev webpack-dev-server</code></p>
</li>
<li><p>修改配置文件：告知 webpack-dev-server 在哪里查找文件</p>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">  contentBase: <span class="string">&#x27;./dist&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>添加 script 脚本</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack-dev-server --open&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<ul>
<li>修改源文件，web 服务器就会自动重新加载编译后的代码</li>
</ul>
<p>(3) webpack-dev-middleware（模块热替换），把 webpack 处理后的文件传递给一个服务器(server)</p>
<ul>
<li><p>安装 express 和 webpack-dev-middleware： <code>npm install --save-dev express webpack-dev-middleware</code></p>
</li>
<li><p>配置文件中 output 添加  publicPat 选项： <code>publicPath: &#39;/&#39;</code></p>
</li>
<li><p>自定义一个 express 服务，添加 server.js 文件，内容如下：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> webpackDevMiddleware = <span class="built_in">require</span>(<span class="string">&#x27;webpack-dev-middleware&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config.js&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> compiler = <span class="title function_">webpack</span>(config);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Tell express to use the webpack-dev-middleware and use the webpack.config.js</span></span><br><span class="line"><span class="comment">// configuration file as a base.</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">webpackDevMiddleware</span>(compiler, &#123;</span><br><span class="line">  <span class="attr">publicPath</span>: config.<span class="property">output</span>.<span class="property">publicPath</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Serve the files on port 3000.</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Example app listening on port 3000!\n&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>添加 npm script： <code>&quot;server&quot;: &quot;node server.js&quot;,</code></p>
</li>
<li><p>执行 <code>npm run server</code>， 打开 <a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000/</a> 即是项目地址</p>
</li>
</ul>
<blockquote>
<p>具体事例请参考 example 目录下的 chapterFour</p>
</blockquote>
<h2 id="六、模块热替换"><a href="#六、模块热替换" class="headerlink" title="六、模块热替换"></a>六、模块热替换</h2><h3 id="1-添加-webpack-自带的插件-NamedModulesPlugin-和-HotModuleReplacementPlugin"><a href="#1-添加-webpack-自带的插件-NamedModulesPlugin-和-HotModuleReplacementPlugin" class="headerlink" title="1. 添加 webpack 自带的插件 NamedModulesPlugin 和 HotModuleReplacementPlugin"></a>1. 添加 webpack 自带的插件 NamedModulesPlugin 和 HotModuleReplacementPlugin</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">  <span class="attr">contentBase</span>: <span class="string">&#x27;./dist&#x27;</span>,</span><br><span class="line">  <span class="attr">hot</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> webpack.<span class="title class_">NamedModulesPlugin</span>(),</span><br><span class="line">  <span class="keyword">new</span> webpack.<span class="title class_">HotModuleReplacementPlugin</span>()</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<h3 id="2-修改-index-js-文件，监听该文件所引用的外部文件的更新状况"><a href="#2-修改-index-js-文件，监听该文件所引用的外部文件的更新状况" class="headerlink" title="2. 修改 index.js 文件，监听该文件所引用的外部文件的更新状况"></a>2. 修改 index.js 文件，监听该文件所引用的外部文件的更新状况</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">module</span>.<span class="property">hot</span>) &#123;</span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&#x27;./print.js&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Accepting the updated printMe module!&#x27;</span>);</span><br><span class="line">    <span class="title function_">printMe</span>();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-css-等静态资源加载了相应的-loader，会自动更新"><a href="#3-css-等静态资源加载了相应的-loader，会自动更新" class="headerlink" title="3. css 等静态资源加载了相应的 loader，会自动更新"></a>3. css 等静态资源加载了相应的 loader，会自动更新</h3><h3 id="4-其他热更新-loader-或插件"><a href="#4-其他热更新-loader-或插件" class="headerlink" title="4.其他热更新 loader 或插件"></a>4.其他热更新 loader 或插件</h3><ul>
<li><p>React Hot Loader：实时调整 react 组件。</p>
</li>
<li><p>Vue Loader：此 loader 支持用于 vue 组件的 HMR，提供开箱即用体验。</p>
</li>
<li><p>Elm Hot Loader：支持用于 Elm 程序语言的 HMR。</p>
</li>
<li><p>Redux HMR：无需 loader 或插件！只需对 main store 文件进行简单的修改。</p>
</li>
<li><p>Angular HMR：没有必要使用 loader！只需对主要的 NgModule 文件进行简单的修改，由 HMR API 完全控制。</p>
</li>
</ul>
<h2 id="七、输出优化"><a href="#七、输出优化" class="headerlink" title="七、输出优化"></a>七、输出优化</h2><h3 id="1-移除-JavaScript-上下文中的未引用代码-dead-code"><a href="#1-移除-JavaScript-上下文中的未引用代码-dead-code" class="headerlink" title="1. 移除 JavaScript 上下文中的未引用代码(dead-code)"></a>1. 移除 JavaScript 上下文中的未引用代码(dead-code)</h3><p>package.json 文件设置 sideEffects 属性 </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;sideEffects&quot;</span>: [</span><br><span class="line">  <span class="string">&quot;./src/some-side-effectful-file.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;*.css&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="2-压缩输出，设置编译模式为-production"><a href="#2-压缩输出，设置编译模式为-production" class="headerlink" title="2.压缩输出，设置编译模式为 production"></a>2.压缩输出，设置编译模式为 production</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">mode</span>: <span class="string">&quot;production&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="八、生产环境构建"><a href="#八、生产环境构建" class="headerlink" title="八、生产环境构建"></a>八、生产环境构建</h2><h3 id="1-构建目标比较"><a href="#1-构建目标比较" class="headerlink" title="1.构建目标比较"></a>1.构建目标比较</h3><p><strong>生产环境构建目标：</strong> 更小的 bundle、更轻量的 source map、更优化的资源、更短的加载时间</p>
<p><strong>开发环境构建目标：</strong> 强大的 source map 和具有热模块替换能力的 localhost server</p>
<h3 id="2-针对不同环境配置-webpack"><a href="#2-针对不同环境配置-webpack" class="headerlink" title="2.针对不同环境配置 webpack"></a>2.针对不同环境配置 webpack</h3><p>(1) 安装 webpack-merge：<code>npm install --save-dev webpack-merge</code></p>
<p>(2) 针对不同的环境创建对应的配置文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.common.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="title class_">CleanWebpackPlugin</span></span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">app</span>: <span class="string">&#x27;./src/index.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;Production&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [&#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|svg|jpg|gif)$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="string">&#x27;file-loader&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(woff|woff2|eot|ttf|otf)$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="string">&#x27;file-loader&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(csv|tsv)$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="string">&#x27;csv-loader&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.xml$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="string">&#x27;xml-loader&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.dev.js</span></span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.common.js&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">merge</span>(common, &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&#x27;inline-source-map&#x27;</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">contentBase</span>: <span class="string">&#x27;./dist&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">NamedModulesPlugin</span>(),</span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">HotModuleReplacementPlugin</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//webpack.prod.js</span></span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UglifyJSPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;uglifyjs-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.common.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">merge</span>(common, &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">UglifyJSPlugin</span>(&#123;<span class="attr">sourceMap</span>: <span class="literal">true</span>&#125;) <span class="comment">// 不支持 es6 语法的压缩</span></span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>(3) 修改 NPM Script</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;start&quot;</span>: <span class="string">&quot;webpack-dev-server --open --config webpack.dev.js&quot;</span>,</span><br><span class="line"><span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --config webpack.prod.js&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="九、代码分离"><a href="#九、代码分离" class="headerlink" title="九、代码分离"></a>九、代码分离</h2><h3 id="1-针对多个文件指定对应的入口"><a href="#1-针对多个文件指定对应的入口" class="headerlink" title="1.针对多个文件指定对应的入口"></a>1.针对多个文件指定对应的入口</h3><h3 id="2-把多个地方引用的代码分离到一个文件中，防止重复引用"><a href="#2-把多个地方引用的代码分离到一个文件中，防止重复引用" class="headerlink" title="2.把多个地方引用的代码分离到一个文件中，防止重复引用"></a>2.把多个地方引用的代码分离到一个文件中，防止重复引用</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">  <span class="attr">runtimeChunk</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;manifest&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">    <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">      <span class="attr">commons</span>: &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;vendor&quot;</span>,</span><br><span class="line">        <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-动态导入"><a href="#3-动态导入" class="headerlink" title="3.动态导入"></a>3.动态导入</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// output 添加 chunkFilename 字段</span></span><br><span class="line"><span class="attr">chunkFilename</span>: <span class="string">&#x27;[name].bundle.js&#x27;</span>,</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.js 动态引入库，编译之后可以看到对应的 loadash-chunk</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> element = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  element.<span class="property">innerHTML</span> = _.<span class="title function_">join</span>([<span class="string">&#x27;Hello&#x27;</span>, <span class="string">&#x27;webpack&#x27;</span>], <span class="string">&#x27; &#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> element;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getComponent</span>().<span class="title function_">then</span>(<span class="function"><span class="params">component</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(component);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css"><p><span>本文标题：</span>Webpack</p><p><span>文章作者：</span>Canace</p><p><span>发布时间：</span>2019-08-04</p><p><span>最后更新：</span>2025-12-28</p><p><span>原始链接：</span><a href="/webpack/">https://canace.site/webpack/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://canace.site/webpack/"></i></span></p><p><span>版权声明：</span>转载请注明出处</p></div><br><script type="text/javascript" src="../js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://canace.site/webpack/" data-id="cmkkhendg00njc1v8bhp45myq" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABxklEQVR42u3aS46DMBAFQO5/aWY7G8PrNjbMqLyKImLKWVj9O454nYM1eibf51ixcHFxp7nn5fr9zIg1oo/edb3nzZFwcXE3cue3rh7s+sDD73FxcT/JfSoAwsXF/R/chJInRbi4uN/nJoFLkvDMhDgP52q4uLgT3LxKue7zkvouLi5ui3sWV7JPFKb03o6Li7uFO99KyY+XHCk6MC4u7hZuHtxUGy1JmpQ0aHFxcd/iJgFNcs1VWzLJYXBxcd/iPjWgOZM+NYc7cXFxH+X2KqzVQYr8+osKIri4uIu51RZpryzybIkEFxd3Nbd66cxfQ0nhdUjHxcXdyM1/kLdYeonQzZ+Ci4u7kVvttySXXe+KLNy7uLi4y7h5u3QqNJlo35anR3FxcR/i5ulN3nqplj/KB8bFxV3MzcOO6jfVxKnQ/8HFxX2Jmxc6q0NXvSFRXFzcPdyzuHrXWTUwuhnMwsXFXcydGcaqhibJb5uTI7i4uAu41csrB1UHvMrJDy4u7mJu0mLpFUOP1sLFxf2L3Lzome8ctV1xcXE/zO29cqaJi4uLu59bTX567ZCkSHqzDy4u7hZu9SrJBzGrzZhqqISLi7uA+wPFVGfWEg5MRgAAAABJRU5ErkJggg==">分享</a><div class="tags"><a href="../tags/build-deploy/"><i class="fa fa-tag"></i>构建与部署</a></div><div class="post-nav"><a class="pre" href="../regular-expressions/">正则</a><a class="next" href="../github-travis-auto-build-vue-to-gitpage/">Github  + Travis 自动构建 Vue 项目到 Gitpage</a></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 常用文档</i></div><ul></ul><a href="/git-common-commands" title="Git 文档" target="_blank">Git 文档</a><ul></ul><a href="/common-programming-prompt-words" title="常用开发提示词" target="_blank">常用开发提示词</a></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/soft/">软技能与思考</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/intelligent/">AI探索</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/cli/">工程化与运维</a><span class="category-list-count">49</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/web/">Web开发</a><span class="category-list-count">140</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/coding/">编程基础</a><span class="category-list-count">42</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/site/">网站建设</a><span class="category-list-count">5</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="../tags/essays/" style="font-size: 15px; color: #bbc3c8">随笔</a> <a href="../tags/performance/" style="font-size: 15px; color: #88a6bb">性能优化</a> <a href="../tags/JavaScript-TypeScript/" style="font-size: 15px; color: #11649e">JavaScript&TypeScript</a> <a href="../tags/server-side/" style="font-size: 15px; color: #6694b3">服务端</a> <a href="../tags/Python-Go-%E5%85%B6%E4%BB%96/" style="font-size: 15px; color: #99b0c0">Python/Go/其他</a> <a href="../tags/backend/" style="font-size: 15px; color: #bbc3c8">后端</a> <a href="../tags/api-services/" style="font-size: 15px; color: #bbc3c8">API&服务</a> <a href="../tags/computer-science/" style="font-size: 15px; color: #3377a7">计算机科学</a> <a href="../tags/reading-notes/" style="font-size: 15px; color: #ccc">读书笔记</a> <a href="../tags/frontend/" style="font-size: 15px; color: #005b9a">前端</a> <a href="../tags/frameworks-libs/" style="font-size: 15px; color: #558aaf">框架与库</a> <a href="../tags/programming-languages/" style="font-size: 15px; color: #aab9c4">编程语言</a> <a href="../tags/css-visualization/" style="font-size: 15px; color: #226ea2">CSS与可视化</a> <a href="../tags/dev-tools/" style="font-size: 15px; color: #4481ab">开发工具</a> <a href="../tags/system-design/" style="font-size: 15px; color: #aab9c4">系统</a> <a href="../tags/build-deploy/" style="font-size: 15px; color: #779db7">构建与部署</a> <a href="../tags/Node-js/" style="font-size: 15px; color: #99b0c0">Node.js</a> <a href="../tags/cross-platform/" style="font-size: 15px; color: #99b0c0">跨端方案</a> <a href="../tags/code-quality/" style="font-size: 15px; color: #ccc">代码质量</a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2026 <a href="../." rel="nofollow">Canace 的博客</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="../js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="../js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="../css/search.css?v=0.0.0"><script type="text/javascript" src="../js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="../js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="../js/smartresize.js?v=0.0.0"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":200,"height":200},"mobile":{"show":false},"react":{"opacity":0.7},"log":false});</script></body></html>